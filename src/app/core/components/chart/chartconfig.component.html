<h3 mat-dialog-title>{{'key_chartConfig'|translate}}</h3>
<div mat-dialog-content fxLayout="column" fxLayoutGap="10px">
  <!-- chart type and chart title -->
  <div fxFlex="auto" fxLayout="row" fxLayoutGap="20px">
    <mat-form-field fxFlex="auto" cdkFocusInitial>
      <mat-select [placeholder]="'key_chartType'|translate" [(ngModel)]="data.objectConfig.seriesType">
        <mat-option value="pie">pie</mat-option>
        <mat-option value="donut">donut</mat-option>
        <mat-option value="column">column</mat-option>
        <mat-option value="line">line</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field fxFlex="auto">
      <input matInput [placeholder]="'key_chartTitle'|translate" [(ngModel)]="data.objectConfig.chartTitle">
    </mat-form-field>
  </div>
  <mat-accordion fxFlex="auto" style="padding-bottom: 5px;">
    <mat-expansion-panel *ngFor="let serie of data.objectConfig.seriesConfig" style="max-height: 350px; overflow-y: auto;">
      <mat-expansion-panel-header style="margin-left: -12px;">{{serie.name}}</mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <mat-card *ngFor="let query of serie.queryConfig" style="border-left: solid darkseagreen 5px; margin-bottom: 10px; padding: 12px;">
          <mat-card-header fxLayout="row" fxLayoutAlign="end center">
            <button mat-button color="warn" [disabled]="serie.queryConfig.length === 1" matTooltip="{{'key_delete'|translate}}"
              (click)="onDeleteQuery(serie, query)" style="width: 24px; min-width: 24px; padding: 0; margin: 0;">
              <mat-icon>delete_forever</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content fxLayout="column" fxLayoutGap="10px">
            <div fxFlex="auto" fxLayout="row" fxLayoutGap="10px">
              <mat-form-field fxFlex="auto">
                <input matInput [placeholder]="'key_queryName'|translate" [(ngModel)]="query.name">
              </mat-form-field>
              <mat-form-field fxFlex="auto">
                <input matInput [placeholder]="'key_queryMethod'|translate" [(ngModel)]="query.method">
              </mat-form-field>
            </div>
            <mat-form-field fxFlex="auto">
              <input matInput [placeholder]="'key_query'|translate" [(ngModel)]="query.query">
            </mat-form-field>
          </mat-card-content>
        </mat-card>
      </ng-template>
      <mat-action-row>
        <button mat-button color="primary" (click)="onApplySeries()">
          <mat-icon style="margin-right: 10px; font-size: 16px; height: 18px;">assignment_turned_in</mat-icon>{{'key_apply'|translate}}
        </button>
        <button mat-button (click)="onAddQuery(serie)">
          <mat-icon style="margin-right: 10px; font-size: 16px; height: 18px;">playlist_add</mat-icon>{{'key_apply'|translate}}
        </button>
        <button mat-button color="warn" [disabled]="data.objectConfig.seriesConfig.length===1">
          <mat-icon style="margin-right: 10px; font-size: 16px; height: 18px;">delete</mat-icon>{{'key_delete'|translate}}
        </button>
      </mat-action-row>
    </mat-expansion-panel>
    <mat-expansion-panel [expanded]="true" style="max-height: 350px; overflow-y: auto;">
      <mat-expansion-panel-header style="margin-left: -12px;">{{'key_advancedSettings'|translate}}</mat-expansion-panel-header>
      <div fxFlex="auto" fxLayout="column" fxLayoutGap="20px">
        <!-- chart legend -->
        <div fxFlex="auto" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
          <mat-slide-toggle fxFlex="none" [(ngModel)]="data.objectConfig.legend.visible" style="width: 120px;"
            #legendVisible>{{'key_chartLegend'|translate}}</mat-slide-toggle>
          <mat-form-field fxFlex="auto">
            <mat-select [placeholder]="'key_chartLegendPosition'|translate" [(ngModel)]="data.objectConfig.legend.position"
              [disabled]="!legendVisible.checked">
              <mat-option value="top">top</mat-option>
              <mat-option value="bottom">bottom</mat-option>
              <mat-option value="left">left</mat-option>
              <mat-option value="right">right</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <!-- chart tooltip -->
        <div fxFlex="auto" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
          <mat-slide-toggle fxFlex="none" [(ngModel)]="data.objectConfig.tooltipConfig.visible" style="width: 120px;"
            #tooltipVisible>{{'key_chartTooltip'|translate}}</mat-slide-toggle>
          <mat-form-field fxFlex="auto">
            <input matInput [placeholder]="'key_chartTooltipFormat'|translate" [(ngModel)]="data.objectConfig.tooltipConfig.format"
              [disabled]="!tooltipVisible.checked">
          </mat-form-field>
        </div>
        <!-- chart label -->
        <div fxFlex="auto" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
          <mat-slide-toggle fxFlex="none" [(ngModel)]="data.objectConfig.labelConfig.visible" style="width: 120px;"
            #labelVisible>{{'key_chartLabel'|translate}}</mat-slide-toggle>
          <div fxFlex="auto" fxLayout="row" fxLayoutAlign="start center">
            <mat-form-field fxFlex="auto" style="margin-right: 10px;">
              <input matInput [placeholder]="'key_chartLabelFormat'|translate" [(ngModel)]="data.objectConfig.labelConfig.format"
                [disabled]="!labelVisible.checked">
            </mat-form-field>
            <div fxFlex="0 0 auto" [(colorPicker)]="data.objectConfig.labelConfig.color" cpPosition="top"
              [style.backgroundColor]="data.objectConfig.labelConfig.color" style="height: 24px; width: 24px; cursor: pointer; border: solid darkgray"
              [cpDisabled]="!labelVisible.checked"></div>
          </div>
        </div>
        <!-- chart colors -->
        <div fxFlex="auto" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
          <div fxFlex="none" style="width: 120px; font-weight: 400; font-size: 14px;">{{'key_chartColors'|translate}}</div>
          <div fxFlex="auto" style="display: flex;">
            <div *ngFor="let color of data.objectConfig.seriesColor; let i = index; trackBy:trackByFn" [(colorPicker)]="data.objectConfig.seriesColor[i]"
              (colorPickerClose)="onCPClosed()" cpPosition="top" [style.backgroundColor]="data.objectConfig.seriesColor[i]"
              style="height: 24px; width: 24px; cursor: pointer;margin-right: 10px; border: solid darkgray;"></div>
          </div>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>
<div mat-dialog-actions fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="20px" style="margin-top: 20px;">
  <button fxFlex mat-button mat-dialog-close="submit">{{'key_submit'|translate}}</button>
  <button fxFlex mat-button mat-dialog-close="cancel">{{'key_cancel'|translate}}</button>
</div>
